<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Posts | Diego Castro | Pandora Box</title>
    <link>https://diegocastroviadero.com/post/</link>
      <atom:link href="https://diegocastroviadero.com/post/index.xml" rel="self" type="application/rss+xml" />
    <description>Posts</description>
    <generator>Source Themes Academic (https://sourcethemes.com/academic/)</generator><language>es-es</language><lastBuildDate>Tue, 20 Oct 2020 16:44:00 +0000</lastBuildDate>
    <image>
      <url>https://diegocastroviadero.com/images/icon_hu5b71f2ac8f47c835f06dc78dd1a89e98_16136_512x512_fill_lanczos_center_2.png</url>
      <title>Posts</title>
      <link>https://diegocastroviadero.com/post/</link>
    </image>
    
    <item>
      <title>Cómo exponer una instalación casera de Home Assistant a Internet</title>
      <link>https://diegocastroviadero.com/post/como-exponer-homeassistant-a-internet/</link>
      <pubDate>Tue, 20 Oct 2020 16:44:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/como-exponer-homeassistant-a-internet/</guid>
      <description>&lt;p&gt;En este post explicaré cómo expongo mi &lt;strong&gt;instalación local&lt;/strong&gt; de 
&lt;a href=&#34;https://www.home-assistant.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Home Assistant&lt;/a&gt; a Internet a través de un &lt;strong&gt;dominio propio&lt;/strong&gt; y de forma &lt;strong&gt;segura&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;La &lt;em&gt;instalación local&lt;/em&gt; de Home Assistant no es más que una raspberry pi conectada al router de mi proveedor de internet.&lt;/p&gt;
&lt;p&gt;El &lt;em&gt;dominio propio&lt;/em&gt; es un dominio adquirido en 
&lt;a href=&#34;https://domains.google.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;google domains&lt;/a&gt;, concretamente se trata del dominio &lt;code&gt;popishome.com&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;El acceso al Home Assistant es &lt;em&gt;seguro&lt;/em&gt; porque se va a realizar utilizando el protocolo HTTPs. Se cifrará la conexión con un certificado de 
&lt;a href=&#34;https://letsencrypt.org&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Let&amp;rsquo;s Encrypt&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Con estos mimbres se plantean varias cuestiones:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;La raspberry pi está conectada al router del proveedor a internet por lo que la manera de llegar a la raspberry será utilizando la IP que el provedor de internet me haya asignado. En mi caso, dicha dirección IP puede variar al antojo del proveedor ya que no tengo contratada una IP fija. La cuestión que se plantea es ¿Cómo conseguir que el dominio apunte contínuamente a la IP que tengo asignada en cada momento? ¿Qué pasa cuando el proveedor de internet me cambia la IP?&lt;/li&gt;
&lt;li&gt;Let&amp;rsquo;s Encrypt lanza un desafío para obtener un certificado, que normalmente requiere de un acceso por http al puerto 80 de quien inicia el desafío, que en este caso sería la raspberry. Sin embargo, algunos proveedores de internet tienen el puerto 80 reservado y no dejan abrirlo ¿Cómo solventar dicho inconveniente?&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;La primera cuestión la podríamos resolver creando en Google Domains un &lt;code&gt;Dynamic DNS&lt;/code&gt; para nuestro dominio y obteniendo unos credenciales para el mismo.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/dynamic_domain.png&#34; alt=&#34;Crear un Dynamic DNS en Google Domains&#34;&gt;&lt;/p&gt;
&lt;p&gt;A continuación se configuraría en el Home Assistant el módulo de Google Domains para que actualice periódicamente los registros del DNS con la IP que tengamos asignada en cada momento.&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# Example configuration.yaml entry
google_domains:
  domain: subdomain.domain.com
  username: YOUR_USERNAME
  password: YOUR_PASSWORD
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sin embargo, de esta forma únicamente se resuelve la primera de las cuestiones. Me gustaría disponer de una misma solución para solventar ambas cuestiones: 
&lt;a href=&#34;https://www.cloudflare.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cloudflare&lt;/a&gt; al rescate!&lt;/p&gt;
&lt;h1 id=&#34;cloudflare&#34;&gt;Cloudflare&lt;/h1&gt;
&lt;p&gt;&lt;em&gt;Cloudflare&lt;/em&gt; es una red de entrega de contenido (CDN) que nos va a permitir resolver las dos cuestiones que se plantean al inicio. Por un lado tiene un api que permitirá a la raspberry pi notificar de forma periódica cuál es su dirección IP. Y por otro lado también expone un API que permite realizar un desafío DNS para la obtención del certificado, en lugar del habitual desafío http.&lt;/p&gt;
&lt;p&gt;Una vez registrados en Cloudflare, se accede a la cuenta y se da de alta el dominio propio de Google Domains:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cloudflare_new_site.png&#34; alt=&#34;Añadir nuestro dominio en Cloudflare&#34;&gt;&lt;/p&gt;
&lt;p&gt;Al dar de alta el nuevo sitio lo haremos con la siguiente configuración:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Acceso directo (opción &lt;code&gt;DNS Only&lt;/code&gt;)&lt;/li&gt;
&lt;li&gt;Sin SSL&lt;/li&gt;
&lt;li&gt;Sin DNSSEC&lt;/li&gt;
&lt;li&gt;Sin ningún tipo de optimización de javascript&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Una vez dado de alta el sitio, habrá que configurar en el dominio de Google Domains los nameserver que se indiquen en Cloudflare:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cloudflare_nameservers.png&#34; alt=&#34;Nameservers en Cloudflare&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/google_domains_nameservers.png&#34; alt=&#34;Nameservers en Google Domains&#34;&gt;&lt;/p&gt;
&lt;p&gt;Con todo esto, pasaremos a configurar el módulo de Cloudflare en el Home Assistant:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;cloudflare:
  email: &amp;lt;EMAIL&amp;gt;
  api_key: !secret cloudflare_globalapikey
  zone: popishome.com
  records:
    - domotic
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El &lt;code&gt;api_key&lt;/code&gt; se corresponde al &lt;code&gt;Global Api Key&lt;/code&gt; y lo obtenemos de la configuración del perfil (&lt;em&gt;My Profile&lt;/em&gt;) en Cloudflare:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cloudflare_global_api_key.png&#34; alt=&#34;Global api key en Cloudflare&#34;&gt;&lt;/p&gt;
&lt;p&gt;Con esta configuración se ha resuelto la primera de las cuestiones. Home Assistant notificará periódicamente la IP a Cloudflare y actualizará los registros DNS consecuentemente.&lt;/p&gt;
&lt;p&gt;Para resolver la segunda cuestión utilizaré un &lt;em&gt;add-on&lt;/em&gt; de Home Assistant, concretamente he utilizado &lt;code&gt;NGINX Proxy Manager&lt;/code&gt;. He seleccionado este add-on y no el oficial de NGINX, porque me resulta más sencillo de configurar y porque se integra con Cloudflare. Este add-on permite obtener fácilmente certificados de Let&amp;rsquo;s Encrypt y en lugar de pasar el habitual desafío HTTP se puede indicar que sea mediante un desafío DNS. El desafío DNS consiste simplemente en añadir de forma temporal unos registros DNS para que Let&amp;rsquo;s Encrypt pueda comprobar que estamos en posesión del dominio. Para poder añadir estos registros temporales hay que disponer de un token con permisos para editar el DNS en Cloudflare.&lt;/p&gt;
&lt;p&gt;La generación de un token con los permisos necesarios se hará desde &lt;em&gt;My Profile&lt;/em&gt; de Cloudflare:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cloudflare_api_token.png&#34; alt=&#34;Token con permisos para editar DNS en Cloudflare&#34;&gt;&lt;/p&gt;
&lt;p&gt;Una vez generado el token, desde la pantalla de administración del add-on NGINX Proxy Manager se genera un nuevo certificado:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/nginx_proxy_manager_ssl_cert.png&#34; alt=&#34;Nuevo certificado SSL en NGINX Proxy Manager&#34;&gt;&lt;/p&gt;
&lt;p&gt;Ya con el certificado generado, configuramos un nuevo proxy para el Home Assistant:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/nginx_proxy_manager_host_details.png&#34; alt=&#34;Nuevo Proxy Host en NGINX Proxy Manager&#34;&gt;&lt;/p&gt;
&lt;p&gt;Y finalmente, configuramos SSL para dicho host, utilizando el certificado que hemos generado anteriormente:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/nginx_proxy_manager_host_ssl.png&#34; alt=&#34;Configuracion SSL para el Proxy Host en NGINX Proxy Manager&#34;&gt;&lt;/p&gt;
&lt;p&gt;Lo último que queda por realizar, es abrir en el router del proveedor a internet el puerto configurado en el NGINX Proxy Manager para el protocolo HTTPs:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/nginx_proxy_manager_config.png&#34; alt=&#34;Configuracion de puertos de NGINX Proxy Manager&#34;&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;En mi caso particular he tenido que realizar un paso extra porque estoy utilizando Google WiFi en casa y tengo creada una red interna. He tenido que mapear el puerto de la red &amp;ldquo;externa&amp;rdquo; (la del router del proveedor a internet) y la red &amp;ldquo;interna&amp;rdquo; (la creada por Google WiFi y en la que está conectada la raspberry con el Home Assistant)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Quería poner el enlace a Google WiFi pero no lo encuentro. Me he acordado de que era un producto que no se vendía en Europa y me lo trajeron de USA (parece que sigue sin venderse aquí). Sí que he encontrado 
&lt;a href=&#34;https://store.google.com/product/nest_wifi&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Nest WiFi&lt;/a&gt; que tiene pinta de ser lo mismo pero comercializado bajo la marca Nest.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;
&lt;p&gt;Mediante el uso de Cloudflare he sido capaz de resolver las 2 cuestiones que se me planteaban al principio. Por un lado se actualiza la IP de la raspberry en los registros DNS del dominio propio. Y por otro lado se obtienen certificados de Let&amp;rsquo;s Encrypt para el dominio propio y se utilizan para establecer una conexión segura. No lo he mencionado hasta el momento, pero la funcionalidad de Cloudflare que he utilizado no tiene coste alguno.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/homeassistant_secure.png&#34; alt=&#34;Acceso seguro a Home Assistant a través de un dominio propio&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Monto un cluster Kubernetes con Raspberry Pi (parte IV)</title>
      <link>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-iv/</link>
      <pubDate>Wed, 14 Oct 2020 17:09:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-iv/</guid>
      <description>&lt;p&gt;Esta es una serie de posts en la que voy a explicar cómo he montado un cluster de Kubernetes utilizando Raspberry Pi y algún ejemplo de uso.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Parte&lt;/th&gt;
&lt;th&gt;Título&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-i&#34;&gt;P01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Hardware&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-ii&#34;&gt;P02&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Sistema Operativo y Docker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iii&#34;&gt;P03&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Cluster K3S&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;P04&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Consumo eléctrico&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P05&lt;/td&gt;
&lt;td&gt;(proximamente)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;introducción&#34;&gt;Introducción&lt;/h1&gt;
&lt;p&gt;En un post anterior de esta serie ya mencioné la primera disyuntiva a la que me enfrenté: 
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-i/#introducci%c3%b3n&#34;&gt;cloud vs. on premise&lt;/a&gt;. En ese momento tuve en cuenta los costes de ambas alternativas, aunque la comparativa fue poco precisa, ya que para la opción &lt;em&gt;on premise&lt;/em&gt; no tuve en cuenta el coste eléctrico para mantener el cluster encendido. Es por esto que desde entonces he buscado la manera de medir el gasto eléctrico del cluster.&lt;/p&gt;
&lt;p&gt;Desde un principio era totalmente consciente de que el proyecto del cluster me iba a llevar varios meses, y eso teniendo únicamente en cuenta únicamente el tiempo de investigación, prueba y aprendizaje. Si evoluciona como espero, el cluster se convertirá en una pieza central y tendrá un uso continuado. Mi intención es utilizarlo para ejecutar en él algunas aplicaciones que uso habitualmente y que tengo desperdigadas en varias raspberry por la casa, como por ejemplo el Home Assistant que se menciona en este post.&lt;/p&gt;
&lt;p&gt;Teniendo en cuenta que el cluster va a estar en funcionamiento ininterrumpidamente, considero que sería muy interesante medir el consumo eléctrico y calcular su coste. De esta forma podría hacer una comparativa más precisa entre el coste de un cluster en el cloud y el coste de este cluster.&lt;/p&gt;
&lt;h1 id=&#34;cómo-medir-el-consumo-eléctrico&#34;&gt;¿Cómo medir el consumo eléctrico?&lt;/h1&gt;
&lt;p&gt;Para medir el consumo del cluster me he decantado por un 
&lt;a href=&#34;https://www.amazon.es/gp/product/B07C864DSZ/ref=ppx_yo_dt_b_asin_title_o05_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Sonoff Pow R2&lt;/a&gt;. Lo he colocado &amp;ldquo;antes&amp;rdquo; de la regleta que alimenta todos los elementos del cluster. De esta forma toda la corriente necesaria para hacer funcionar el cluster: luces, ventilación, raspberry, switch&amp;hellip; pasará a través del Sonoff y podrá ser contabilizada de forma global.&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/sonoff_en_cluster_resized.jpg&#34; alt=&#34;Sonoff Pow R2 en cluster&#34;&gt;&lt;/p&gt;
&lt;p&gt;Para acoplar el Sonoff a la caja del cluster he diseñado 
&lt;a href=&#34;#piezas-para-la-caja-del-cluster&#34;&gt;unas piezas&lt;/a&gt; y las he imprimido con mi impresora 3D. He decidido inicialmente dejar el Sonoff en el exterior para tener una mejor cobertura WiFi ¿La caja del cluster actuaría como una 
&lt;a href=&#34;https://en.wikipedia.org/wiki/Faraday_cage&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;caja Faraday&lt;/a&gt;? En este caso he preferido ser pruedente y dejarlo incialmente por fuera, aunque no sea lo más estético. En un futuro quizás me anime a rediseñar las piezas para dejar el Sonoff en el interior de la caja del cluster.&lt;/p&gt;
&lt;p&gt;De nada sirve medir el consumo si no se realiza un registro del mismo. Para realizar el registro del consumo eléctrico contabilizado por el Sonoff he aprovechado una instancia de 
&lt;a href=&#34;https://www.home-assistant.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Home Assistant&lt;/a&gt; que tengo para la domótica de mi casa. De esta forma puedo disponer fácilmente de un panel para visualizar dicho consumo. En este post no voy a explicar cómo instalar Home Assistant, aunque sí que voy a describir algunas de las configuraciones que he tenido que cambiar.&lt;/p&gt;
&lt;h1 id=&#34;sonoff-pow-r2&#34;&gt;Sonoff Pow R2&lt;/h1&gt;
&lt;p&gt;Este es un dispositivo barato que podría definirse como un interruptor &amp;ldquo;inteligente&amp;rdquo; que puede controlarse via WiFi y que permite medir el consumo eléctrico. En este caso no lo utilizo como interruptor, sino únicamente lo uso para medir el consumo. La forma de &amp;ldquo;anular&amp;rdquo; el interruptor (con software) es configurarlo de tal forma que esté siempre &amp;ldquo;encendido&amp;rdquo;. Otra forma más invasiva de conserguirlo sería desoldar el relay y puentearlo.&lt;/p&gt;
&lt;p&gt;Sonoff proporciona una aplicación móvil a través de la cual se pueden controlar los diferentes dispositivos de la marca, programarlos y visualizar la información que generan. Para que todo esto sea posible, la información generada por los dispositivos viaja hasta los servidores de la empresa y desde ahí a los dispositivos móviles.&lt;/p&gt;
&lt;p&gt;Sin embargo, ni me interesa que mis datos pasen por un servidor de un tercero, ni tengo interés en usar una aplicación móvil adicional, porque lo que quiero es integrarlo con Home Assistant. La ventaja de Home Assistant es que me permite integrar dispositivos de distintos fabricantes, tener toda la domótica centralizada y utilizar una única aplicación para controlar todo. En este caso, tiene la ventaja añadida de que los datos no pasan por ningún servidor ajeno, se quedan en casa.&lt;/p&gt;
&lt;h1 id=&#34;cómo-integrar-sonoff-con-home-assistant&#34;&gt;¿Cómo integrar Sonoff con Home Assistant?&lt;/h1&gt;
&lt;p&gt;
&lt;a href=&#34;https://esphome.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;ESPHome&lt;/a&gt; es la respuesta!&lt;/p&gt;
&lt;p&gt;&lt;em&gt;ESPHome&lt;/em&gt; es un sistema que permite controlar de forma remota dispositivos &lt;em&gt;ESP8266&lt;/em&gt; y &lt;em&gt;ESP32&lt;/em&gt;. Y casualmente los dispositivos Sonoff llevan un chip ESP8266. Realmente no es casualidad, esto es algo que investigué antes de decidirme a comprar el Sonoff Pow R2. Al descubrir ESPHome y lo fácil que era integrarlo con Home Assistant, la decisión estaba clara.&lt;/p&gt;
&lt;p&gt;La integración de ESPHome con Home Assistant es muy sencilla y consiste en 
&lt;a href=&#34;https://esphome.io/guides/getting_started_hassio.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;instalar un add-on en Home Assistant&lt;/a&gt;. La instalación del add-on es muy sencilla pero he tenido problemas de acceso a la interfaz a través de NGINX, debidos al uso de WebSockets que hace el add-on de ESPHome. Para solucionarlo he incluído la 
&lt;a href=&#34;#configuraci%c3%b3n-nginx-para-websockets-de-esphome&#34;&gt;siguiente configuración en NGINX&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;programación-del-sonoff&#34;&gt;Programación del Sonoff&lt;/h1&gt;
&lt;p&gt;Para poder controlar un dispositivo con el chip ESP8266 mediante ESPHome hay que flashear en el chip un binario con el código de ESPHome. Para flashear dicho binario he utilizado 
&lt;a href=&#34;https://github.com/esphome/esphome-flasher/releases&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;esphome-flasher&lt;/a&gt;. En imprescindible un &lt;em&gt;adaptador serie USB a TTL&lt;/em&gt; para poder conectar el dispositivo a un PC y flashear el código. Yo he utilizado un 
&lt;a href=&#34;https://www.amazon.es/gp/product/B07HM7RPB7/ref=ppx_yo_dt_b_asin_title_o05_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;adaptador CH340G&lt;/a&gt;. Los drivers de los adaptadores se encuentran accesibles 
&lt;a href=&#34;#drivers-adaptador-usb-a-ttl&#34;&gt;aquí&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;cómo-obtenemos-el-binario-con-el-código-a-flashear&#34;&gt;¿Cómo obtenemos el binario con el código a flashear?&lt;/h2&gt;
&lt;p&gt;Esto es una tarea muy sencilla, gracias a ESPHome que lo simplifica al máximo. Simplemente hay que generar un fichero yaml con la configuración y comportamiento que queramos que tenga el dispositivo. ESPHome se encarga de generar un binario con el código correspondiente al contenido de dicho fichero yaml.&lt;/p&gt;
&lt;p&gt;Este es el fichero yaml que he utilizado en este caso:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;esphome:
  name: rpicluster_power
  platform: ESP8266
  board: esp01_1m

# WiFi connection
wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: &amp;quot;Rpicluster Sonoff POW R2&amp;quot;
    password: &amp;quot;rpiclustersonoffpowr2&amp;quot;

# Enable logging
logger:
  baud_rate: 0

# Enable Home Assistant API
api:

# Enable over-the-air updates
ota:

# Enable Web server
web_server:
  port: 80

uart:
  rx_pin: RX
  baud_rate: 4800

sensor:
  - platform: wifi_signal
    name: &amp;quot;RPI Cluster WiFi Signal&amp;quot;
    update_interval: 15s
    icon: mdi:wifi
  - platform: uptime
    name: &amp;quot;RPI Cluster Uptime&amp;quot;
  # Power sensor
  - platform: cse7766
    update_interval: 5s
    # Current sensor
    current:
      name: &amp;quot;RPI Cluster Current&amp;quot;
      icon: mdi:current-ac
      unit_of_measurement: A
      accuracy_decimals: 3
    # Voltage sensor
    voltage:
      name: &amp;quot;RPI Cluster Voltage&amp;quot;
      icon: mdi:flash
      unit_of_measurement: V
      accuracy_decimals: 1
    # Power sensor
    power:
      name: &amp;quot;RPI Cluster Power&amp;quot;
      icon: mdi:gauge
      unit_of_measurement: W
      accuracy_decimals: 0
      id: rpiclusterpower

  - platform: total_daily_energy
    name: &amp;quot;RPI Cluster Daily Energy&amp;quot;
    power_id: rpiclusterpower
    filters:
      - multiply: 0.001
    unit_of_measurement: kWh
    icon: mdi:chart-bar

time:
  - platform: homeassistant
    id: homeassistant_time

interval:
  - interval: 10s
    then:
      if:
        condition:
          wifi.connected:
        then:
          - light.turn_on: led
        else:
          - light.turn_off: led

binary_sensor:
  # Binary sensor for the button press
  - platform: gpio
    name: &amp;quot;RPI Cluster Power Button&amp;quot;
    pin:
      number: GPIO0
      mode: INPUT_PULLUP
      inverted: true
    on_press:
      - switch.toggle: relay
  
  - platform: status
    name: &amp;quot;RPI Cluster Status&amp;quot;

switch:
  - platform: gpio
    name: &amp;quot;RPI Cluster Sonoff Relay&amp;quot;
    id: relay
    pin: GPIO12
    restore_mode: RESTORE_DEFAULT_ON

  - platform: restart
    name: &amp;quot;RPI Cluster Sonoff Restart&amp;quot;

output:
  - platform: esp8266_pwm
    id: pow_blue_led
    pin:
      number: GPIO13
      inverted: True

light:
  - platform: monochromatic
    name: &amp;quot;RPI Cluster POW Blue LED&amp;quot;
    output: pow_blue_led
    id: led

text_sensor:
  - platform: version
    name: &amp;quot;RPI Cluster POW Version&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;La información de los pines de entrada/salida del sonoff se encuentra en la 
&lt;a href=&#34;https://esphome.io/devices/sonoff.html#sonoff-pow-r2&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;documentación&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Quiero destacar que el sonoff únicamente hay que conectarlo al pc para flashearlo la primera vez. En el yaml anterior se habilita &lt;code&gt;OTA&lt;/code&gt; (over-the-air), lo que permite actualizar el código a través de la conexión WiFi, sin necesidad de volver a abrir el dispositivo y desmontarlo de donde estuviera.&lt;/p&gt;
&lt;h1 id=&#34;panel-de-control&#34;&gt;Panel de control&lt;/h1&gt;
&lt;p&gt;Gracias a la integración de ESPHome con Home Assistant es muy sencillo crear un panel de control como el que se ve en la siguiente imagen:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cluster_home_assistant_dashboard.png&#34; alt=&#34;Imagen dashboard&#34;&gt;&lt;/p&gt;
&lt;p&gt;En el panel anterior se dispone de:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Consumo actual
&lt;ul&gt;
&lt;li&gt;Corriente&lt;/li&gt;
&lt;li&gt;Potencia&lt;/li&gt;
&lt;li&gt;Voltaje&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Estado
&lt;ul&gt;
&lt;li&gt;Tiempo en marcha (
&lt;a href=&#34;#template-para-el-tiempo-encencido&#34;&gt;ver template en anexo&lt;/a&gt; )&lt;/li&gt;
&lt;li&gt;Versión de ESPHome en el sonoff&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Histórico de consumo&lt;/li&gt;
&lt;li&gt;Consumo diario&lt;/li&gt;
&lt;li&gt;Estado y control del led azul
&lt;ul&gt;
&lt;li&gt;Este led lo utilizo para representar la conectividad a la WiFi (encendido significa conectado)&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Estado y control del relay&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;El pico de consumo de más de 1500W no se corresponde a un uso normal del cluster. Se corresonde a unas pruebas de estuve realizando para calibrar el Sonoff. La calibración del Sonoff queda fuera del ámbito de este post y lo explicaré en otro momento.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;
&lt;p&gt;El principal objetivo de construir este cluster era didáctico. A día de hoy no tengo claro si esta va a ser su única finalidad o si, una vez terminado, lo voy a utilizar con otros fines, puesto que ideas no me faltan. Conocer el consumo eléctrico y su consiguiente coste económico es una variable que voy a tener muy en cuenta a la hora de decidir el uso del cluster a medio-largo plazo.&lt;/p&gt;
&lt;h1 id=&#34;anexo&#34;&gt;Anexo&lt;/h1&gt;
&lt;h2 id=&#34;configuración-nginx-para-websockets-de-esphome&#34;&gt;Configuración NGINX para WebSockets de ESPHome&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;location /api/hassio_ingress {
    resolver 127.0.0.11 valid=30s;
    # Home Assistant IP
    set $upstream_app 192.168.86.4;
    # Home Assistant Internal Port
    set $upstream_port 8123;
    # Home Assistant Internal Protocol
    set $upstream_proto http;
    proxy_pass $upstream_proto://$upstream_app:$upstream_port;

    # Home Assistant External Host:Port
    proxy_set_header Host $host:9443;

    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection &amp;quot;upgrade&amp;quot;;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;drivers-adaptador-usb-a-ttl&#34;&gt;Drivers adaptador USB a TTL&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;a href=&#34;resources/ttl_drivers/CH340G.rar&#34;&gt;CH340G&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;resources/ttl_drivers/CP210x_Universal_Windows_Driver.zip&#34;&gt;CP210X&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;
&lt;a href=&#34;resources/ttl_drivers/PL2303_Prolific_DriverInstaller_v1_8_0.zip&#34;&gt;PL2303&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;template-para-el-tiempo-en-marcha&#34;&gt;Template para el tiempo en marcha&lt;/h2&gt;
&lt;p&gt;Por defecto el tiempo que lleva encendido el sonoff se envía en segundos. Este dispositivo está pensado para estar contínuamente encendido enviando las lecturas, independientemente de si el cluster está en marcha o no. Por este motivo no tiene mucho sentido visualizar en el panel esta información en crudo. Para transformar este dato en otro que aporte más valor he creado el siguiente template en el Home Assistant:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;sensor:
  - platform: template
    sensors:
      rpi_cluster_pow_uptime_readable:
        friendly_name: &amp;quot;RPI Cluster Uptime&amp;quot;
        icon_template: &amp;quot;mdi:timer&amp;quot;
        value_template: &amp;gt;-
          {% set uptime = states.sensor.rpi_cluster_pow_uptime.state | int %}
          {% set days = (uptime / 86400) | int %}
          {%- if days &amp;gt; 0 -%}
            {{ days }} days, {{ (uptime - (days * 86400)) | int | timestamp_custom(&#39;%H:%M:%S&#39;, false) }}
          {%- else -%}
            {{ uptime | int | timestamp_custom(&#39;%H:%M:%S&#39;, false) }}
          {%- endif -%}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si lleva más de un día encendido, se visualizará el número de días que lleva encendido junto con las horas, minutos y segundos. Si lleva menos de un día, simplemente se visualizarán las horas, minutos y segundos.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Este template podría mejorarse aún más teniendo en cuenta meses y años&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;piezas-para-la-caja-del-cluster&#34;&gt;Piezas para la caja del cluster&lt;/h2&gt;
&lt;p&gt;Para realizar el diseño de todas las piezas he utilizado 
&lt;a href=&#34;https://www.onshape.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;OnShape&lt;/a&gt;. Todos los diseños que he realizado para la caja son públicos y encuentran disponibles 
&lt;a href=&#34;https://cad.onshape.com/documents?nodeId=4157ec7e4f12d21ec2893ac1&amp;amp;resourceType=folder&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Como se puede ver en las siguientes imágenes, las piezas para albergar el Sonoff no son las únicas que he diseñado para la caja del cluster. También he diseñado una tapa para una de las aberturas traseras y otra tapa para albergar tanto la 
&lt;a href=&#34;https://www.amazon.es/gp/product/B07RRY5MYZ/ref=ppx_yo_dt_b_asin_title_o06_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;toma de corriente&lt;/a&gt; como la 
&lt;a href=&#34;https://www.amazon.es/gp/product/B01MD2AYSW/ref=ppx_yo_dt_b_asin_title_o04_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;toma de red&lt;/a&gt; de todo el cluster:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cluster_trasera_exterior.jpg&#34; alt=&#34;Trasera cluster desde el exterior&#34;&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cluster_trasera_interior.jpg&#34; alt=&#34;Trasera cluster desde el interior&#34;&gt;&lt;/p&gt;
&lt;p&gt;Estoy muy contento con el resultado final, la verdad que ha quedado todo muy organizado y con un mínimo de cables:&lt;/p&gt;
&lt;p&gt;&lt;img src=&#34;./resources/cluster_final_frontal.jpg&#34; alt=&#34;Frontal del cluster&#34;&gt;&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Monto un cluster Kubernetes con Raspberry Pi (parte III)</title>
      <link>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-iii/</link>
      <pubDate>Wed, 14 Oct 2020 05:00:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-iii/</guid>
      <description>&lt;p&gt;Esta es una serie de posts en la que voy a explicar cómo he montado un cluster de Kubernetes utilizando Raspberry Pi y algún ejemplo de uso.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Parte&lt;/th&gt;
&lt;th&gt;Título&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-i&#34;&gt;P01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Hardware&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-ii&#34;&gt;P02&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Sistema Operativo y Docker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;P03&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Cluster K3S&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iv&#34;&gt;P04&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Consumo eléctrico&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P05&lt;/td&gt;
&lt;td&gt;(proximamente)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;k3s&#34;&gt;K3s&lt;/h1&gt;
&lt;p&gt;
&lt;a href=&#34;https://k3s.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;K3s&lt;/a&gt; es una distribución de kubernetes certificada que ha sido concebida para el mundo &lt;em&gt;IoT&lt;/em&gt; y &lt;em&gt;
&lt;a href=&#34;https://en.wikipedia.org/wiki/Edge_computing&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Edge Computing&lt;/a&gt;&lt;/em&gt;. K3s ha sido optimizada para ARM (ARM64 y ARMv7) y esto es lo que ha hecho decidirme por esta distribución para instalar kubernetes en el cluster de raspberry pi. En K3s se han reducido las dependencias al máximo, haciendo posible que se distribuya como un único binario de menos de 40 MB. La reducción de dependencias también ha supuesto una simplificación del proceso de instalación.&lt;/p&gt;
&lt;h1 id=&#34;instalación&#34;&gt;Instalación&lt;/h1&gt;
&lt;p&gt;La instalación es muy sencilla, ya que el equipo de K3s ha creado un &lt;em&gt;playbook&lt;/em&gt; de Ansible para realizarla. Yo me he basado en dicho playbook y he realizado alguna pequeña adaptación/mejora.&lt;/p&gt;
&lt;p&gt;Lo primero que he realizado ha sido adaptar el fichero de inventario a las necesidades del playbook, para ello he definido los grupos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;k3s_master&lt;/code&gt;: que incluye el nodo maestro&lt;/li&gt;
&lt;li&gt;&lt;code&gt;k3s_node&lt;/code&gt;: que incluye los nodos esclavos&lt;/li&gt;
&lt;li&gt;&lt;code&gt;k3s_cluster&lt;/code&gt;: que incluye todos los miembros del cluster&lt;/li&gt;
&lt;/ul&gt;
&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[k3s_master:children]
rpicluster01

[k3s_node:children]
rpicluster02
rpicluster03
rpicluster04
rpicluster05

[k3s_cluster:children]
k3s_master
k3s_node
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;(se puede ver el fichero completo 
&lt;a href=&#34;https://github.com/dicastro/rpicluster/blob/master/playbooks/inventory&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;A continuación se muestra el playbook de instalación:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;- hosts: k3s_cluster
  gather_facts: true
  become: true
  roles:
    - role: prereq
    - role: download
    - role: ubuntu

- hosts: k3s_master
  become: true
  roles:
    - role: k3s/master

- hosts: k3s_node
  become: true
  roles:
    - role: k3s/node
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como se puede observar, se basa en el uso de &lt;em&gt;roles&lt;/em&gt;. Existen 3 roles de preparación (&lt;code&gt;prereq&lt;/code&gt;, &lt;code&gt;download&lt;/code&gt; y &lt;code&gt;ubuntu&lt;/code&gt;) que se ejecutarán sobre todos los miembros del cluster. Estos roles se encargan de activar algunas configuraciones necesarias en el sistema operativo, así como de realizar la descarga del binario en función de la arquitectura sobre la que se esté realizando la instalación.&lt;/p&gt;
&lt;p&gt;Además existe un role que se ejecutará sobre el nodo maestro y otro que se ejecutará sobre los nodos esclavos. Estos roles son los que crean el cluster K3s propiamente dicho.&lt;/p&gt;
&lt;p&gt;(se puede ver el playbook completo 
&lt;a href=&#34;https://github.com/dicastro/rpicluster/tree/master/playbooks/03_cluster_k3s_cluster&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;)&lt;/p&gt;
&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;
&lt;p&gt;Gracias al equipo de desarrollo de K3s, que nos proporciona un playbook de Ansible, se puede crear un cluster de kubernetes de una manera muy sencilla.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Monto un cluster Kubernetes con Raspberry Pi (parte II)</title>
      <link>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-ii/</link>
      <pubDate>Sun, 27 Sep 2020 11:19:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-ii/</guid>
      <description>&lt;p&gt;Esta es una serie de posts en la que voy a explicar cómo he montado un cluster de Kubernetes utilizando Raspberry Pi y algún ejemplo de uso.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Parte&lt;/th&gt;
&lt;th&gt;Título&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-i&#34;&gt;P01&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Hardware&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;P02&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Sistema Operativo y Docker&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iii&#34;&gt;P03&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Cluster K3S&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iv&#34;&gt;P04&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Consumo eléctrico&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P05&lt;/td&gt;
&lt;td&gt;(proximamente)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;sistema-operativo&#34;&gt;Sistema Operativo&lt;/h1&gt;
&lt;p&gt;Una vez que todo el hardware está montado la siguiente decisión a tomar es qué sistema operativo instalar en las Raspberry. En el momento de tomar la decisión barajaba 3 opciones:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Raspbian&lt;/li&gt;
&lt;li&gt;Hypriot&lt;/li&gt;
&lt;li&gt;Ubuntu&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;em&gt;Raspbian&lt;/em&gt; es la distribución oficial para raspberry, y sería una buena elección. Sin embargo, no me he decantado por esta opción, y la razón principal es que en el momento de tomar la decisión no había una versión final de 64 bits (estaba en beta).&lt;/p&gt;
&lt;p&gt;&lt;em&gt;Hypriot&lt;/em&gt; es una distribución que desconocía totalmente y que viene con docker preinstalado, lo cual simplificaría el proceso de instalación y supondría un ahorro de tiempo. Tampoco me he decidido por esta opción, y el motivo es el mismo que con &lt;em&gt;Raspbian&lt;/em&gt;, no existe una versión de 64 bits.&lt;/p&gt;
&lt;p&gt;Tras haber descartado las dos distribuciones anteriores me entró la duda de si mi idea inicial de instalar una distribución de 64 bits era una buena idea. Inicialmente pensaba que con una distribución de 32 bits no podría aprovechar los 8 GB de RAM de las raspberry y de ahí que buscase una distribución de 64 bits. Tras investigar un poco, me di cuenta de que esto no era cierto del todo, con una distribución de 32 bits sí que se aprovecharían los 8 GB de RAM. Un mismo proceso del sistema operativo podría usar como mucho 4 GB de RAM, pero entre varios procesos se podrían consumir los 8 GB. Aún así, mantuve mi idea inicial de instalar una distribución de 64 bits, creo que no tiene sentido a día de hoy comenzar un proyecto optando por 32 bits, aunque esta elección traiga ciertas &amp;ldquo;ventajas&amp;rdquo; inicialmente.&lt;/p&gt;
&lt;p&gt;Finalmente descubrí que &lt;em&gt;Ubuntu&lt;/em&gt; tiene distribuciones para &lt;em&gt;ARM&lt;/em&gt; y que estas pueden ser de 64 bits. Así que - &amp;ldquo;Señores, ¡Ya tenemos caballo ganador!&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Con el sistema operativo elegido lo siguiente era:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;flashear las 5 tarjetas de memoria&lt;/li&gt;
&lt;li&gt;actualizar y realizar ciertas configuraciones en las 5 raspberry&lt;/li&gt;
&lt;li&gt;instalar Docker en las 5 raspberry&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En estos momentos me arrepentí un poco de haber comprado 5 raspberry porque todo lo que fuese a hacer lo tenía que repetir 5 veces. Si tienes claro el proceso, es cuestión de seguirlo a pies juntillas y repetirlo las veces que sea necesario. El problema viene cuando el proceso no está claramente definido, y con cada repetición se va refinando el mismo. Este &amp;ldquo;ir refinando el proceso a medida que lo vas repitiendo&amp;rdquo; no debería ser algo problemático. El problema radica en mi persona y mi obsesión con algunas cosas, y en este caso mi obsesión no me permitiría sentirme cómodo sabiendo que no he ejecutado el mismo proceso en todas las raspberry. Si cuando estoy en la última raspberry me doy cuenta de que sería mejor hacer algo de forma diferente, me vería obligado a volver a hacerlo en todas las raspberry. Aquí es donde la situación podría descontrolarse y llevarme muchísimo más tiempo del necesario con la &lt;em&gt;única ventaja&lt;/em&gt; de tener todas las rapberry exactamente iguales.&lt;/p&gt;
&lt;p&gt;Antes de lanzarme a configurar las raspberry busqué la forma de automatizar todo el proceso de configuración, lo cual me permitiría dormir tranquilo sabiendo que todas las raspberry son &lt;em&gt;almas gemelas&lt;/em&gt; sin tener que repetir manualmente el proceso de configuración por enésima vez sobre la &lt;em&gt;oveja negra del rebaño&lt;/em&gt;. Y la búsqueda fue fructífera, me topé con 
&lt;a href=&#34;https://cloudinit.readthedocs.io&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cloud-Init&lt;/a&gt; y con 
&lt;a href=&#34;https://docs.ansible.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Ansible&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id=&#34;cloud-init&#34;&gt;Cloud-Init&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Cloud-Init&lt;/em&gt; es una tecnología que permite inicializar una instancia y que viene de caja con Ubuntu. Cloud-Init detecta si es el primer arranque del sistema y si es el caso entra en acción permitiendo configurar: usuarios, claves ssh, particiones de disco, configuración de red, etc. Cloud-Init puede obtener las acciones que tiene que ejecutar del propio disco de la instacia o podría obtenerlo a través de la red.&lt;/p&gt;
&lt;p&gt;En mi caso, las acciones a actualizar las obtiene del propio disco: una vez flasheada la tarjeta SD copio un par de ficheros en la tarjeta con las configuraciones a realizar. Concretamente utilizo cloud-init para:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;actualizar los paquetes del sistema&lt;/li&gt;
&lt;li&gt;establecer el nombre de la instancia&lt;/li&gt;
&lt;li&gt;configurar el DNS&lt;/li&gt;
&lt;li&gt;desactivar la creación del usuario por defecto del sistema operativo&lt;/li&gt;
&lt;li&gt;crear un usuario específico&lt;/li&gt;
&lt;li&gt;establecer una clave SSH para el usuario&lt;/li&gt;
&lt;li&gt;deshabilitar el acceso al sistema con contraseña&lt;/li&gt;
&lt;li&gt;configuración de una ip fija&lt;/li&gt;
&lt;li&gt;instalación de paquetes adicionales: &lt;code&gt;curl&lt;/code&gt;, &lt;code&gt;vim&lt;/code&gt;, &lt;code&gt;git&lt;/code&gt; y &lt;code&gt;aptitude&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Este es un ejemplo de fichero de configuración de cloud-init de uno de los nodos del cluster:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;#cloud-config

preserve_hostname: false
hostname: rpicluster01
fqdn: rpicluster01.test

package_update: true
package_upgrade: true
package_reboot_if_required: true

manage_resolv_conf: true
resolv_conf:
  nameservers: [&#39;8.8.4.4&#39;, &#39;8.8.8.8&#39;]

users:
## Disable creation of default user
#- default
## Create user
- name: rpicluster
  homedir: /home/rpicluster
  lock_passwd: true
  shell: /bin/bash
  # Generate key with command: ssh-keygen -t rsa -b 4096 -C &amp;quot;your_email@example.com&amp;quot;
  ssh_authorized_keys:
    - **************************************************************************************
  sudo:
    - ALL=(ALL) NOPASSWD:ALL

## Disable password authentication with the SSH daemon
ssh_pwauth: false

## Install additional packages on first boot
packages:
- curl
- vim
- git
- aptitude

final_message: &amp;quot;The system is finally up, after $UPTIME seconds&amp;quot;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;La configuración de red se establece en otro fichero diferente que tiene la siguiente pinta:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;# This file contains a netplan-compatible configuration which cloud-init
# will apply on first-boot. Please refer to the cloud-init documentation and
# the netplan reference for full details:
#
# https://cloudinit.readthedocs.io/
# https://netplan.io/reference
#
# Some additional examples are commented out below

version: 2
ethernets:
  eth0:
    dhcp4: false
    addresses: [192.168.86.51/24]
    gateway4: 192.168.86.1
    mtu: 1500
    nameservers:
      addresses: [8.8.4.4, 8.8.8.8]
    optional: true
#wifis:
#  wlan0:
#    dhcp4: true
#    optional: true
#    access-points:
#      myhomewifi:
#        password: &amp;quot;S3kr1t&amp;quot;
#      myworkwifi:
#        password: &amp;quot;correct battery horse staple&amp;quot;
#      workssid:
#        auth:
#          key-management: eap
#          method: peap
#          identity: &amp;quot;me@example.com&amp;quot;
#          password: &amp;quot;passw0rd&amp;quot;
#          ca-certificate: /etc/my_ca.pem
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Para flashear la imagen del sistema operativo en la tarjeta SD utilizo 
&lt;a href=&#34;https://www.raspberrypi.org/blog/raspberry-pi-imager-imaging-utility&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;rpiimager&lt;/a&gt;. Esta herramienta te provee de una interfaz gráfica muy sencilla en la que en primer lugar se selecciona la imagen que quieres flashear, en segundo lugar se elige dónde la quieres flashear y por último se inicia la grabación. Esta herramienta te evita tener que descargar la imagen del sistema operativo ya que es la propia herramienta quien se encarga de descargarla.&lt;/p&gt;
&lt;p&gt;Al arrancar la raspberry por primera vez cloud-init se activará y ejecutará las acciones anteriores, lo único que hay que hacer es esperar unos minutos. Alguien perspicaz, se habrá dado cuenta que hay dos acciones en la lista anterior que no son iguales para todas las raspberry del cluster: establecer el nombre de la instancia y configurar una ip fija. Esto hace que haya que tener para cada instancia del cluster un fichero de configuración diferente. Y en este punto es donde entra en acción &lt;em&gt;Ansible&lt;/em&gt;.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Aunque se le asigne una ip fija a las raspberry, en el router habrá que reservarla igualmente, ya que podría darse el caso de que mientras está apagado el cluster, se conecte algún dispositivo a la red y se le asigne una de las ips del cluster.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;ansible&#34;&gt;Ansible&lt;/h2&gt;
&lt;p&gt;&lt;em&gt;Ansible&lt;/em&gt;, resumiéndolo mucho, es una herramienta de automatización de tareas. Dado un fichero de inventario, en el que se definen una serie de máquinas; y un fichero de tareas (&lt;em&gt;playbook&lt;/em&gt;), en el que se definen una serie de tareas; Ansible se encargará de ejecutar cada una de las tareas en cada una de las máquinas. Con el añadido de que la ejecución de dichas tareas es &lt;em&gt;idempotente&lt;/em&gt;, es decir, que si alguna de las tareas ya se ha ejecutado en alguna de dichas máquinas, no la volverá a ejecutar. Esto es una simplificación muy grande de todo el universo de Ansible, pero en este post no quiero entrar en detalles sobre Ansible, sino en explicar lo mínimo para que se entienda de qué forma se ha utilizado esta herramienta para montar el cluster.&lt;/p&gt;
&lt;p&gt;Como he mencionado anteriormente, he utilizado Ansible para la generación de los ficheros de configuración de cloud-init. Y este es un caso de uso un poco especial, puesto que no se ajusta a la descripción anterior sobre el funcionamiento básico de Ansible. Sí que disponemos de un fichero de inventario, pero no utilizamos Ansible para ejecutar ninguna tarea sobre las máquinas del inventario, sino para obtener unos datos sobre dichas máquinas y utilizarlos para generar unos ficheros de configuración en el puesto local.&lt;/p&gt;
&lt;p&gt;Este es un extracto del fichero de inventario:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-ini&#34;&gt;[rpicluster01]
192.168.86.51

[rpicluster01:vars]
custom_hostname=rpicluster01


[rpicluster02]
192.168.86.52

[rpicluster02:vars]
custom_hostname=rpicluster02


[rpicluster03]
192.168.86.53

[rpicluster03:vars]
custom_hostname=rpicluster03


[rpicluster04]
192.168.86.54

[rpicluster04:vars]
custom_hostname=rpicluster04


[rpicluster05]
192.168.86.55

[rpicluster05:vars]
custom_hostname=rpicluster05


[rpicluster:children]
rpicluster01
rpicluster02
rpicluster03
rpicluster04
rpicluster05
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En este caso hemos definido el inventario en un fichero en formato &lt;code&gt;INI&lt;/code&gt;. Se puede ver que se han definido varios grupos. Hay un grupo con un solo elemento para cada una de las máquinas del cluster y así poder hacer referencia a una máquina concreta:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rpicluster01&lt;/li&gt;
&lt;li&gt;rpicluster02&lt;/li&gt;
&lt;li&gt;rpicluster03&lt;/li&gt;
&lt;li&gt;rpicluster04&lt;/li&gt;
&lt;li&gt;rpicluster05&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;También hay un grupo que está compuesto por todas las máquinas del cluster, para poder hacer referencia a todo el cluster:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;rpicluster&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Para cada una de las máquinas se define una propiedad &lt;code&gt;custom_hostname&lt;/code&gt; que contiene el nombre de la máquina.&lt;/p&gt;
&lt;p&gt;(se puede ver el fichero completo 
&lt;a href=&#34;https://github.com/dicastro/rpicluster/blob/master/playbooks/inventory&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;)&lt;/p&gt;
&lt;p&gt;A continuación se muestra el &lt;em&gt;playbook&lt;/em&gt; de ansible que genera los ficheros de configuración de cloud-init para las máquinas del cluster:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-yaml&#34;&gt;---
- hosts: rpicluster
  gather_facts: false
  tasks:
    - name: create directories
      file:
        path: &amp;quot;../../cloud-init/{{ hostvars[inventory_hostname][&#39;custom_hostname&#39;] }}&amp;quot;
        state: directory
      delegate_to: localhost

    - name: generate user-data config file from template
      template:
        src: template_userdata.j2
        dest: &amp;quot;../../cloud-init/{{ hostvars[inventory_hostname][&#39;custom_hostname&#39;] }}/user-data&amp;quot;
      delegate_to: localhost

    - name: generate network-config file from template
      template:
        src: template_networkconfig.j2
        dest: &amp;quot;../../cloud-init/{{ hostvars[inventory_hostname][&#39;custom_hostname&#39;] }}/network-config&amp;quot;
      delegate_to: localhost
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Se definen 3 tareas:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;La tarea 1 se encarga de crear un directorio para cada una de las máquinas del inventario&lt;/li&gt;
&lt;li&gt;La tarea 2 genera el fichero de configuración &lt;code&gt;user-data&lt;/code&gt; a partir de un template&lt;/li&gt;
&lt;li&gt;La tarea 3 genera el fichero de configuración &lt;code&gt;network-config&lt;/code&gt; a partir de un template&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;(se puede ver el playbook completo 
&lt;a href=&#34;https://github.com/dicastro/rpicluster/tree/master/playbooks/00_cluster_regenerate_cloudinit_config&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;)&lt;/p&gt;
&lt;h2 id=&#34;cómo-instalar-ansible-en-windows-10&#34;&gt;Cómo instalar Ansible en Windows 10&lt;/h2&gt;
&lt;p&gt;La manera más fácil de utilizar Ansible en Windows 10 es a través del WLS. Para instalar Ansible he utilizado &lt;code&gt;pip&lt;/code&gt;, por lo que el primer paso será instalar &lt;code&gt;pip3&lt;/code&gt; y algunas dependencias necesarias:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;sudo apt install -y python3-pip python3-dev libffi-dev libssl-dev
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;A continuación se instala Ansible (a nivel del usuario):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip3 install ansible --user
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Por último se actualiza el &lt;code&gt;PATH&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;echo &#39;PATH=$HOME/.local/bin:$PATH&#39; &amp;gt;&amp;gt; ~/.bashrc
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Estas son algunas utilidades interesantes que recomiendo tener instaladas para trabajar con Ansible:&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip3 install yamllint ansible-lint molecule
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;actualizar-ansible-29-a-210&#34;&gt;Actualizar Ansible 2.9 a 2.10&lt;/h4&gt;
&lt;p&gt;Recientemente se ha lanzado la versión 2.10 de Ansible y en esta versión ha habido una reestructuración importante de módulos. Debido a esta reestructuración la actualización no se puede hacer ejecutando un &lt;em&gt;upgrade&lt;/em&gt; del paquete ya instalado, sino que hay que desinstalar la versión instalada (la versión 2.9):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip3 uninstall ansible ansible-base
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Y a continuación instalar de nuevo (la última versión, 2.10):&lt;/p&gt;
&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;pip3 install ansible --user
&lt;/code&gt;&lt;/pre&gt;
&lt;h1 id=&#34;docker&#34;&gt;Docker&lt;/h1&gt;
&lt;p&gt;Gracias a Ansible, la instalación de Docker en todas las máquinas se ha simplificado al máximo. He encontrado un playbook, que he utilizado casi tal cual, que se encarga de instalar Docker en sistemas debian. Se puede encontrar la versión que he utilizado 
&lt;a href=&#34;https://github.com/dicastro/rpicluster/tree/master/playbooks/02_cluster_install_docker&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;.&lt;/p&gt;
&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;
&lt;p&gt;Como conclusión he de decir que tanto &lt;em&gt;cloud-init&lt;/em&gt; como &lt;em&gt;Ansible&lt;/em&gt; han sido dos grandes descubrimientos. Sobre todo Ansible, ya que veo que es una herramienta que puedo empezar a utilizar en mi día a día a nivel profesional.&lt;/p&gt;
&lt;p&gt;La única pega que le veo a Ansible, es que algunos aspectos no son compatibles con Windows. Actualmente utilizo un Windows 10 y he podido hacer uso de Ansible sin grandes complicaciones a través de WLS. El único inconveniente que me he topado hasta el momento, ha sido a la hora de utilizar &lt;em&gt;Ansible Vault&lt;/em&gt;, ya que para ciertas situaciones es necesario modificar los permisos de algunos ficheros, lo cual no es posible en WLS a día de hoy (o al menos yo no he encontrado la manera de hacerlo).&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Monto un cluster Kubernetes con Raspberry Pi (parte I)</title>
      <link>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-i/</link>
      <pubDate>Fri, 18 Sep 2020 15:31:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/monto-un-cluster-kubernetes-con-rpi-parte-i/</guid>
      <description>&lt;p&gt;Esta es una serie de posts en la que voy a explicar cómo he montado un cluster de Kubernetes utilizando Raspberry Pi y algún ejemplo de uso.&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Parte&lt;/th&gt;
&lt;th&gt;Título&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;&lt;strong&gt;P01&lt;/strong&gt;&lt;/td&gt;
&lt;td&gt;&lt;strong&gt;Hardware&lt;/strong&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-ii&#34;&gt;P02&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Sistema Operativo y Docker&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iii&#34;&gt;P03&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Cluster K3S&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;
&lt;a href=&#34;../monto-un-cluster-kubernetes-con-rpi-parte-iv&#34;&gt;P04&lt;/a&gt;&lt;/td&gt;
&lt;td&gt;Consumo eléctrico&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;P05&lt;/td&gt;
&lt;td&gt;(proximamente)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h1 id=&#34;introducción&#34;&gt;Introducción&lt;/h1&gt;
&lt;p&gt;Kubernetes es una tecnología de orquestación de contenedores que lleva en el mercado ya varios años. Sin embargo, hasta la fecha, no he tenido la oportunidad de &amp;ldquo;jugar&amp;rdquo; con ella. Llevo varios años trabajando intensamente con Docker, y tenía como asignatura pendiente empezar a utilizar algún orquestador de contenedores. Como a nivel profesional no he tenido la ocasión de hacerlo, y como pienso que como mejor se aprende es practicando, nada mejor para aprender Kubernetes, que montarme un cluster Kubernetes desde cero. Quizás llegue un poco tarde, pero creo que es mejor tarde que nunca.&lt;/p&gt;
&lt;p&gt;Finalmente me he decidido por montar un cluster &lt;em&gt;on premise&lt;/em&gt; en mi casa. Al principio pensé que lo más sencillo, rápido y barato sería hacerlo en el cloud, pero lo cierto es que me daba mucha pereza. Demasiados proveedores, cada uno con unos servicios gratuitos, con unas condiciones de pago por uso diferentes, en alguno de los cuales ya había consumido dicho uso gratuito, etc.&lt;/p&gt;
&lt;p&gt;Aunque montar un cluster &lt;em&gt;on premise&lt;/em&gt; suponga un desembolso inicial superior y un mayor esfuerzo, frente a montarlo en el cloud, encuentro al menos dos motivos que han hecho que me decline por esta opción.&lt;/p&gt;
&lt;p&gt;En primer lugar, considero que montando el cluster &lt;em&gt;on premise&lt;/em&gt; me puede simplificar el aprendizaje de los conceptos básicos, ya que no me veré distraído por la terminología y servicios accesorios varios ofrecidos por los proveedores cloud.&lt;/p&gt;
&lt;p&gt;En segundo lugar, me da mucha tranquilidad saber que si lo apago no consumo nada. Sé que este argumento puede no tener mucho sentido, ya que en el cloud, uno tiene control sobre los servicios que contrata y también podría &amp;ldquo;apagarlo&amp;rdquo; en cualquier momento. La cosa es que el mundo de los proveedores cloud también es nuevo para mí, y el sistema de facturación me parece un poco complejo. Sería otra cosa desconocida adicional a la que enfrentarme. Mi objetivo inicial es aprender Kubernetes, no es conocer como montar un cluster kubernetes en Amazon, Google o Azure y cuánto me van a cobrar por ello. En el pasado ya he tenido algún susto con grandes facturas de proveedores cloud, por creer que estaba haciendo uso de los servicios gratuitos, cuando no era cierto.&lt;/p&gt;
&lt;h1 id=&#34;componentes&#34;&gt;Componentes&lt;/h1&gt;
&lt;p&gt;El cluster está compuesto inicialmente de 5 
&lt;a href=&#34;https://www.tiendatec.es/raspberry-pi/placas-base/1231-raspberry-pi-4-modelo-b-8gb-765756931199.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Raspberry Pi modelo 4b con 8GB de RAM&lt;/a&gt;. Esto hace que el cluster disponga de:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;20 cores a 1&#39;5 GHz&lt;/li&gt;
&lt;li&gt;40 GB de memoia RAM&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Cada Raspberry tiene una tarjeta de memoria microSD 
&lt;a href=&#34;https://www.amazon.es/gp/product/B06XFSZGCC/ref=ppx_yo_dt_b_asin_title_o03_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Samsung EVO Plus de 32GB&lt;/a&gt;. Este almacenamiento será únicamente para la ejecución del sistema operativo. Inicialmente también lo utilizaré para la persistencia de los contenedores del cluster. Más adelante cuando me adentre en el mundo de los volúmenes persistentes, montaré un mecanismo de persistencia dedicado.&lt;/p&gt;
&lt;p&gt;Con el objetivo de facilizar el montaje del cluster y reducir el número de clables necesarios, he comprado unos módulos 
&lt;a href=&#34;https://www.tiendatec.es/raspberry-pi/hats/757-raspberry-pi-hat-poe-r20-0652508442105.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAT PoE&lt;/a&gt; que me permiten alimentar las Raspberry por PoE. De esta forma puedo prescindir de los transformadores y los cables USB para alimentar las Raspberry, ya que con el mismo cable ethernet alimento las Raspberry y les proporciono conexión de red.&lt;/p&gt;
&lt;p&gt;Para poder alimentar las Raspberry por PoE he comprado un switch 
&lt;a href=&#34;https://www.amazon.es/gp/product/B076BV421P/ref=ppx_yo_dt_b_asin_title_o04_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Netgear GS108PP&lt;/a&gt; con 8 puertos y con alimentación PoE en todos. Esto me permite tener hasta 7 Raspberry alimentadas y conectadas, ya que uno de los puertos lo utilizo para conectar el switch a la red.&lt;/p&gt;
&lt;p&gt;Para albergar todos los componentes he comprado un armario rack de 19&amp;rdquo; 
&lt;a href=&#34;https://www.amazon.es/gp/product/B00D5T3TDS/ref=ppx_yo_dt_b_asin_title_o04_s02&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Phasak PHP 2106&lt;/a&gt;. El armario tiene 6U de espacio en total que será utilizado de la siguiente forma:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;1U para una 
&lt;a href=&#34;https://www.amazon.es/gp/product/B00X44HTY4/ref=ppx_yo_dt_b_asin_title_o04_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;reglega de 8 tomas con interruptor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1U para el switch que va sobre una 
&lt;a href=&#34;https://www.amazon.es/gp/product/B001PKPK1I/ref=ppx_yo_dt_b_asin_title_o04_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;bandeja&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2U para alojar hasta 12 Raspberry Pi&lt;/li&gt;
&lt;li&gt;2U libres&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Para colocar todas las Raspberry en fila en el armario rack, he imprimido 
&lt;a href=&#34;https://www.thingiverse.com/thing:4078710&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;este proyecto&lt;/a&gt;, disponible en Thingiverse. Ocupando 2U del rack se pueden tener 12 Raspberry. Cada Raspberry está en una bandeja extraíble, haciendo muy sencillo una sustitución. La mayoría de ejemplos que había visto para apilar Raspberry, lo hacian de tal forma que el recambio de una de ellas implicaría desmontar todo. Este es uno de los pocos que he encontrado que facilita el mantenimiento.&lt;/p&gt;
&lt;p&gt;Antes de poner el cluster en funcionamiento de forma continuada me gustaría tener un mecanismo para medir el consumo del mismo. Tengo pendiente comprar algún dispositivo que me permita medir el consumo y tener algún tipo de histórico para calcular su coste. He hecho una búsqueda rápida y he visto un montón de enchufes baratos que miden el consumo, aunque ninguno me ha convencido. Me gustaría tener una solución que se integre con 
&lt;a href=&#34;https://www.home-assistant.io/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Home Assistant&lt;/a&gt;, que es la solución que tengo en casa para la domótica. Este aspecto queda fuera del ámbito de este post y no me extenderé más en ello.&lt;/p&gt;
&lt;h1 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h1&gt;
&lt;p&gt;La combinación de estos componentes me permite tener un cluster:&lt;/p&gt;
&lt;h4 id=&#34;compacto&#34;&gt;Compacto&lt;/h4&gt;
&lt;p&gt;El armario rack de 19&amp;rdquo; y 6U es un armario de reducidas dimensiones que puedo colocar en cualquier sitio de la casa.&lt;/p&gt;
&lt;h4 id=&#34;ventilado&#34;&gt;Ventilado&lt;/h4&gt;
&lt;p&gt;El armario rack dispone de 2 grandes ventiladores en la parte superior. Además cada Raspberry dispone de un ventilador ya que el &lt;em&gt;HAT PoE&lt;/em&gt; incluye uno. Creo que es ventilación suficiente para dejar el cluster encendido de continuo sin miedo a que se sobrecaliente.&lt;/p&gt;
&lt;h4 id=&#34;ordenado&#34;&gt;Ordenado&lt;/h4&gt;
&lt;p&gt;Los &lt;em&gt;HAT PoE&lt;/em&gt; han ayudado mucho a que el armario no tenga demasiados cables en su interior y a que la regleta tenga más tomas disponibles para su uso.&lt;/p&gt;
&lt;h4 id=&#34;iluminado&#34;&gt;Iluminado&lt;/h4&gt;
&lt;p&gt;El armario rack dispone también de iluminación led, esto me da libertad para poder situar el armario rack en cualquier punto de la casa y poder hacer un mantenimiento del mismo sin problemas de falta de luz.&lt;/p&gt;
&lt;h4 id=&#34;extensible&#34;&gt;Extensible&lt;/h4&gt;
&lt;p&gt;Gracias al proyecto de thingiverse puedo colocar hasta 12 Rasperry ocupando 2U del armario. Con las 2U que me quedan libres podría:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Colocar otras 12 raspberry pi&lt;/li&gt;
&lt;li&gt;Colocar algún dispositivo SAI&lt;/li&gt;
&lt;li&gt;Dedicarlo a almacenamiento&lt;/li&gt;
&lt;li&gt;etc&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&#34;bom&#34;&gt;BOM&lt;/h1&gt;
&lt;ul&gt;
&lt;li&gt;5x 
&lt;a href=&#34;https://www.tiendatec.es/raspberry-pi/placas-base/1231-raspberry-pi-4-modelo-b-8gb-765756931199.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Raspberry Pi modelo 4b con 8GB de RAM&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;5x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B06XFSZGCC/ref=ppx_yo_dt_b_asin_title_o03_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Samsung EVO Plus de 32GB&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;5x 
&lt;a href=&#34;https://www.tiendatec.es/raspberry-pi/hats/757-raspberry-pi-hat-poe-r20-0652508442105.html&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;HAT PoE&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B076BV421P/ref=ppx_yo_dt_b_asin_title_o04_s00&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Netgear GS108PP&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B00D5T3TDS/ref=ppx_yo_dt_b_asin_title_o04_s02&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Phasak PHP 2106&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B00X44HTY4/ref=ppx_yo_dt_b_asin_title_o04_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Reglega de 8 tomas con interruptor&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B001PKPK1I/ref=ppx_yo_dt_b_asin_title_o04_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Bandeja&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B0046UCVFM/ref=ppx_yo_dt_b_asin_title_o03_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Cables de red de 25cm&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B073WDSPS8/ref=ppx_yo_dt_b_asin_title_o03_s01&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tornillos y tuercas para armario rack&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;1x 
&lt;a href=&#34;https://www.amazon.es/gp/product/B081JJ2LRT/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;amp;psc=1&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Tornillos M2.5 para Raspberry Pi&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;2x Varilla roscada M4 de 1m (&lt;em&gt;comprado en ferretería&lt;/em&gt;)&lt;/li&gt;
&lt;li&gt;8x Tuercas M4 (&lt;em&gt;comprado en ferretería&lt;/em&gt;)&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Cómo he automatizado los fichajes de mi empresa</title>
      <link>https://diegocastroviadero.com/post/como-automatizar-los-fichajes-de-mi-empresa/</link>
      <pubDate>Fri, 31 Jan 2020 18:21:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/como-automatizar-los-fichajes-de-mi-empresa/</guid>
      <description>&lt;h2 id=&#34;contexto&#34;&gt;Contexto&lt;/h2&gt;
&lt;p&gt;En el año 2019 hubo un cambio de ley que obliga a todas las empresas de España a proporcionar información sobre la jornada laboral de sus trabajadores, lo que comunmente conocemos como &lt;em&gt;fichajes&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Mi empresa se ha adaptado al cambio de legislación añadiendo una nueva sección en la intranet para que cada empleado pueda registrar la jornada laboral. El enfoque que ha seguido mi empresa es el fichaje &amp;ldquo;en tiempo real&amp;rdquo;, es decir, se toma el momento en el que se están registrando las acciones como el momento en el que las realizas. Esto obliga a fichar en el momento real en el que empiezas a trabajar, en el que comienzas a comer, en el que terminas de comer&amp;hellip; No existe ninguna posibilidad de corrección por parte de los trabajadores, si se olvida registrar alguna de las acciones hay que escribir un email al responsable para indicarlo.&lt;/p&gt;
&lt;p&gt;Este enfoque de &amp;ldquo;tiempo real&amp;rdquo; no es el único posible, he visto otras empresas que también proporcionan un apartado en su intranet, pero que permiten hacer el fichaje &amp;ldquo;en diferido&amp;rdquo;.&lt;/p&gt;
&lt;p&gt;Cuestiones a parte serían si estas implementaciones cumplen con la ley o qué responsabilidades tiene el trabajador o qué pasaría si se hace una inspección y los fichajes del trabajador no son correctos.&lt;/p&gt;
&lt;h2 id=&#34;problema&#34;&gt;Problema&lt;/h2&gt;
&lt;p&gt;La solución tomada por mi empresa no es una solución pensada para el trabajador que sea cómoda de usar, todo lo contrario:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;El trabajador tiene que recordar todas las acciones que tiene que realizar&lt;/li&gt;
&lt;li&gt;Para ciertas acciones el trabajador tiene no sólo que realizar la acción, sino que tiene que escribir un texto válido para dicha acción&lt;/li&gt;
&lt;li&gt;Para realizar cada una de las acciones el trabajador tiene que acceder a la intranet, teniendo que introducir sus credenciales&lt;/li&gt;
&lt;li&gt;Algunas de las acciones se realizan desde sitios donde no hay un ordenador, por lo que hay que acceder a la intranet desde el móvil cuando la intranet no está adaptada para ello. Los menús son muy pequeños y es difícil llegar a la zona de fichajes&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;objetivo&#34;&gt;Objetivo&lt;/h2&gt;
&lt;p&gt;Me he propuesto simplificar todo este proceso de tal forma que los fichajes se realicen de una manera sencilla, y lo más fieles posible a la realidad. Además utilizaré tecnologías que me permitan seguir desarrollándome como profesional de la Informática.&lt;/p&gt;
&lt;h2 id=&#34;requisitos&#34;&gt;Requisitos&lt;/h2&gt;
&lt;p&gt;Estos son los requisitos funcionales que guiarán el planteamiento y desarrollo de la solución:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fichaje lo más fiel posible a la realidad&lt;/li&gt;
&lt;li&gt;Las acciones manuales por parte del usuario serán muy sencillas&lt;/li&gt;
&lt;li&gt;Se tendrán en cuenta los fichajes realizados directamente en la intranet&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;solución&#34;&gt;Solución&lt;/h2&gt;
&lt;p&gt;La solución desarrollada es un chatbot de telegram: 
&lt;a href=&#34;https://t.me/TimeHammerBot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TimeHammerBot&lt;/a&gt;. Lo único necesario para podeer utilizarla será disponer de un smartphone y tener instalada la aplicación de mensajería &lt;em&gt;Telegram&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id=&#34;funcionamiento&#34;&gt;Funcionamiento&lt;/h2&gt;
&lt;p&gt;El trabajador se registrará en el chatbot 
&lt;a href=&#34;https://t.me/TimeHammerBot&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;TimeHammerBot&lt;/a&gt; de &lt;em&gt;Telegram&lt;/em&gt;. Para ello tendrá que indicar la empresa en la que trabaja, los credenciales para acceder a la intranet donde se realiza el fichaje manual y los horarios habituales: hora de comienzo y fin de la jornada laboral y hora de comienzo y fin de la comida (para cada día de la semana). Una vez realizado el registro podrá olvidarse de volver a acceder a la intranet para realizar un fichaje. A partir de ese momento será el chatbot quien le recuerde a las horas configuradas, la realización de las acciones pertinentes. Además junto con cada recordatorio, se proporcionarán una serie de botones que permitirán confirmar la realización de dichas acciones.&lt;/p&gt;
&lt;p&gt;Por ejemplo, si el trabajador ha indicado que los lunes suele comenzar la jornada laboral a las 8:00, a esa hora recibirá un mensaje en &lt;em&gt;Telegram&lt;/em&gt; preguntándole si ya ha comenzado a trabajar. Debajo del mensaje aparecerán una serie de botones: &amp;ldquo;Sí&amp;rdquo;, &amp;ldquo;+5m&amp;rdquo;, &amp;ldquo;+10m&amp;rdquo;, &amp;ldquo;+15m&amp;rdquo;, &amp;ldquo;+20m&amp;rdquo;, &amp;ldquo;No&amp;rdquo;. Al pulsar el botón &amp;ldquo;Sí&amp;rdquo;, el chatbot se encargará de registrar el inicio de la jornada en la intranet. Al pulsar los botones &amp;ldquo;+Xm&amp;rdquo;, se le pedirá al chatbot que se espere X minutos antes de volver a preguntar. Al pulsar el botón &amp;ldquo;No&amp;rdquo;, se le indicará al chatbot que ese día no se trabaja y hasta el día siguiente no volverá a preguntar nada.&lt;/p&gt;
&lt;p&gt;El chatbot recuperará de la intranet las vacaciones del trabajador con el objetivo de no molestar durante ese periodo de tiempo. También tendrá en cuenta los días festivos de la ciudad de trabajo del trabajador (motivo por el cual durante el registro hay que indicar la ciudad de trabajo).&lt;/p&gt;
&lt;p&gt;El chatbot es un mero intermediario, no guardará en ningún momento los fichajes del trabajador. Para conocer el estado de un trabajador lo recuperará de la intranet de la empresa del trabajador. De esta forma se puede combinar el uso del chatbot junto con la realización de ciertas acciones de forma manual. Por ejemplo, si el trabajador ha indicado que los viernes suele comenzar a trabajar a las 8:00, pero excepcionalmente, un viernes comienza su jornada a las 7:30, podrá acceder a la intranet y registrar su fichaje a las 7:30. Cuando sean las 8:00 el chatbot tendrá en cuenta las posibles acciones realizadas manualmente en la intranet antes de preguntar nada. Por lo que en este caso, a las 8:00 el chatbot no preguntará nada al trabajador.&lt;/p&gt;
&lt;p&gt;Con este modelo de funcionamiento se cumplen los 3 requisitos planteados para el proyecto:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Todos los fichajes requerirán de una confirmación por parte del usuario y serán fieles a la realidad.&lt;/li&gt;
&lt;li&gt;El usuario se olvida de tener que conectarse a una intranet y registrar una serie de acciones y en su lugar lo único que tiene que hacer es pulsar un botón cuando le llega un mensaje al &lt;em&gt;Telegram&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;Al no guardar el estado de los trabajadores y recuperarlo siempre de la intranet, se posibilita combinar el uso de ambos sistemas.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;detalles&#34;&gt;Detalles&lt;/h2&gt;
&lt;p&gt;Para conocer más detalles sobre el proyecto puedes acceder 
&lt;a href=&#34;https://diegocastroviadero.com/project/timehammer&#34;&gt;aquí&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h2&gt;
&lt;p&gt;Este proyecto ha supuesto un reto bastante interesante por diversos motivos:&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;- Llevar un proyecto adelante de principio a fin&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;El camino que hay que seguir desde que se tiene una idea hasta que esta se materializa siempre es complicado. A lo largo de este camino existen diversos momentos, en los que lo más fácil es no complicarse y ceder en el intento. Llegar a desplegar en producción una primera versión estable y funcional es motivo suficiente para sentirse orgulloso.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;- Afrontar un nuevo paradigma de programación&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cambiar la manera de pensar no es trivial. Tareas que considerabas sencillas, de repente, se convierten en complicados rompecabezas. Ante la más mínima complicación es tentador volver a las &lt;em&gt;antiguas costumbres&lt;/em&gt; para salir del paso y seguir avanzando. Ha resultado agotador ser &lt;em&gt;fiel&lt;/em&gt; a programación reactiva.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;- Nuevas tecnologías&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;En este proyecto he utilizado muchas tecnologías desconocidas para mi: Quarkus, Kafka, EDA, compilación nativa de java, imágenes distroless. Para mi siempre es motivador enfrentarme a un nuevo framework, lenguaje, herramienta&amp;hellip; me recuerda a cuando era niño y me regalaban un juguete. Lo que resulta un verdadero reto es realizar un proyecto en el que la gran mayorías de las tecnologías son desconocidas y pasas más tiempo en las páginas de documentación que programando.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;- Ponerse un objetivo y ceñirse a él&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Cuando no tienes a un jefe que te va guiando hacia una meta es complicado no desviarse del camino y resulta muy sencillo irse por las ramas. Más aún cuando tienes un montón de &lt;em&gt;&amp;ldquo;juguetitos&amp;rdquo;&lt;/em&gt; nuevos que probar e investigar. Este proyecto no ha sido una excepción, de hecho, la solución final es la tercera que se ha desarrollado desde cero. El proyecto comenzó siendo serverless, basándose en el uso de Firebase. Después se descartó la idea de serverless y pasó a ser un monolito desarrollado en Quarkus. Finalmente se ha mantenido el uso de Quarkus, pero se ha modularizado implementando una arquitectura orientada a eventos.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;Se trata de una primera versión funcional con mucho margen de mejora. He incorporado una gran cantidad de novedades tecnológicas, dada mi experiencia,y hasta el momento no he podido profundizar mucho en ellas para poder tener esta primera versión funcional lo antes posible.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Cómo quiero organizar mi almacenamiento</title>
      <link>https://diegocastroviadero.com/post/como-quiero-organizar-mi-almacenamiento/</link>
      <pubDate>Thu, 30 Jan 2020 19:16:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/como-quiero-organizar-mi-almacenamiento/</guid>
      <description>&lt;p&gt;Llevo ya unos meses pensando en renovar los equipos que tengo, bien porque se han quedado desfasados o bien porque quiero ampliar sus funcionalidades y se quedan cortos de recursos. Actualmente dispongo de los siguientes equipos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;portátil de 13&amp;rsquo; con windows (ligero)&lt;/li&gt;
&lt;li&gt;portátil de 15&amp;rsquo; con windows (antiguo)&lt;/li&gt;
&lt;li&gt;portátil de 17&amp;rsquo; con windows (el más potente)&lt;/li&gt;
&lt;li&gt;raspberry pi con raspbian para la domótica&lt;/li&gt;
&lt;li&gt;raspberry pi con raspbian para la gestión de finanzas&lt;/li&gt;
&lt;li&gt;iMac&lt;/li&gt;
&lt;li&gt;NAS con 2 discos de 2TB en RAID0&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;El NAS cumple con múltiples funciones:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;almacenamiento de documentos&lt;/li&gt;
&lt;li&gt;almacenamiento de backups&lt;/li&gt;
&lt;li&gt;centro multimedia&lt;/li&gt;
&lt;li&gt;centro de descargas&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Para el &lt;em&gt;almacenamiento de documentos&lt;/em&gt; utilizo software propio de QNAP que me permite tener sincronizados determinados directorios de un equipo con el NAS. Además tengo la posibilidad de acceder a los mismos, también a través de aplicaciones de QNAP, desde los dispositivos móviles.&lt;/p&gt;
&lt;p&gt;Para la realización de los &lt;em&gt;backups&lt;/em&gt; utilizo software propio de QNAP para los equipos Windows, que me permite programar backups de forma periódica. En el caso del iMac, utilizo TimeMachine que lo hace de forma automática y transparente.&lt;/p&gt;
&lt;p&gt;Quien realmente cumple con la función de &lt;em&gt;centro multimedia&lt;/em&gt; es Plex Media Server, que está instalado en el NAS, y es quien me permite visualizar el contenido multimedia a través de la Smart TV y de los dispositivos móviles.&lt;/p&gt;
&lt;p&gt;Para la realización de &lt;em&gt;descargas&lt;/em&gt; utilizo un cliente BitTorrent instalado en el NAS, que me permite controlarlo desde los dispositivos móviles.&lt;/p&gt;
&lt;p&gt;Lo que me gustaría es retirar algunos de los portátiles que tengo junto con el iMac y en su lugar comprarme un buen PC que sea potente y que me permita realizar proyectos personales de Data Science.&lt;/p&gt;
&lt;h2 id=&#34;motivación&#34;&gt;Motivación&lt;/h2&gt;
&lt;p&gt;Una renovación del hardware no tendría por qué llevarme a un replanteamiento de la organización en lo que respecta al almacenamiento. Sin embargo, existen una serie de inconvenientes/mejoras pendientes que llevo arrastrando desde hace un tiempo y que son los verdaderos motivadores del cambio:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;En el iMac tengo configurado el TimeMachine para hacer los backups contra el NAS. Parece que no funciona muy bien, porque desde que lo configuré sale un aviso en el NAS indicando que hay datos erróneos en alguno de los volúmenes. Además, el iMac apenas lo utilizo y es uno de los equipos que quiero jubilar&lt;/li&gt;
&lt;li&gt;Sólamente uno de los portátiles con Windows tiene configurados los backups y la sincronización de documentos&lt;/li&gt;
&lt;li&gt;Las Raspberry PI no tienen configurado ningún tipo de backup contra el NAS y, tras haber investigado, QNAP no ofrece demasiadas opciones para Linux&lt;/li&gt;
&lt;li&gt;Me gustaría tener una única solución tanto de backups como de sincronización de documentos, para todos los sistemas operativos&lt;/li&gt;
&lt;li&gt;El QNAP funciona muy lento, las opciones de ampliación de sus recursos hardware son muy limitadas y además quiero ampliar sus funcionalidades (ej: añadirle un repositorio de código, poder hacer seguimiento de series y películas con couchpotato o alternativas similares, etc.)&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Así que aprovechando que voy a hacer cambios en el hardware y teniendo en cuenta todos los puntos anteriores he decidido hacer un cambio radical.&lt;/p&gt;
&lt;h2 id=&#34;qué-me-gustaría-tener&#34;&gt;Qué me gustaría tener&lt;/h2&gt;
&lt;p&gt;Me gustaría tener lo siguiente:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Tener backups de las Raspberry PI de forma periódica y automática&lt;/li&gt;
&lt;li&gt;Tener sincronizados con el NAS algunos directorios tanto de equipos Windows como Linux&lt;/li&gt;
&lt;li&gt;Tener las fotos/videos realizadas con dispositivos móviles guardadas directamente en el NAS de forma automática&lt;/li&gt;
&lt;li&gt;Tener forma de visualizar a través del móvil las fotografías del NAS&lt;/li&gt;
&lt;li&gt;Tener forma de visualizar a través del móvil los documentos del NAS&lt;/li&gt;
&lt;li&gt;Poder montar un volumen del NAS en cualquiera de los portátiles o PC para hacer un backup manual inicial de documentos o fotos&lt;/li&gt;
&lt;li&gt;Que el NAS haga de forma periódica un backup encriptado a algún cloud&lt;/li&gt;
&lt;li&gt;Disponer de un cliente de descargas de BitTorrent y poder controlarlo a través del móvil&lt;/li&gt;
&lt;li&gt;Utilizar Plex Media Server como media center&lt;/li&gt;
&lt;li&gt;Añadir Radarr, Sonarr y Jackett (o CouchPotato) para el seguimiento de series y películas y descargas automatizadas&lt;/li&gt;
&lt;li&gt;Tener un repositorio de código git&lt;/li&gt;
&lt;li&gt;Poder editar documentos, hojas de cálculo, presentaciones, diagramas directamente a través del NAS&lt;/li&gt;
&lt;li&gt;Aplicación de mensajería privada&lt;/li&gt;
&lt;li&gt;Aplicación de notas privada&lt;/li&gt;
&lt;li&gt;Aplicación de calendario privada&lt;/li&gt;
&lt;li&gt;Poder ampliar libremente los recursos del NAS en un futuro&lt;/li&gt;
&lt;li&gt;Poder ampliar libremente la funcionalidad del NAS&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;alternativas&#34;&gt;Alternativas&lt;/h2&gt;
&lt;p&gt;La primera disyuntiva a la que me enfrento es si comprar otro NAS ya montado (al estilo del QNAP) o montármelo yo mismo. La ventaja de comprar uno ya montado es que es &amp;ldquo;enchufar y listo&amp;rdquo;, con el inconveniente de que este tipo de NAS no son demasiado flexibles. La venjata de montarse un NAS es que son totalmente customizables y extensibles, la pega es que requieren de mucho tiempo de investigación, selección de componentes, montaje, configuración y selección de software.&lt;/p&gt;
&lt;h3 id=&#34;nas-ya-montado&#34;&gt;NAS ya montado&lt;/h3&gt;
&lt;p&gt;He descubierto que Synology tiene mejor integración con linux. He encontrado dos modelos que se ajustan a los requisitos: 
&lt;a href=&#34;https://www.synology.com/es-es/products/DS918&amp;#43;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DS918+&lt;/a&gt; y 
&lt;a href=&#34;https://www.synology.com/es-es/products/DS1618&amp;#43;&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;DS1618+&lt;/a&gt;.&lt;/p&gt;
&lt;h4 id=&#34;ds918&#34;&gt;DS918+&lt;/h4&gt;
&lt;p&gt;Cumple con casi todos los requisitos, la única excepción es la ampliación de recursos. Tiene 4 bahías y la posibilidad de comprar una extensión que permitiría añadir más discos. De serie viene con 4GB de RAM ampliables a 8GB, aunque en algún foro he leído que se le pueden meter 16GB (aunque esto está por comprobar). El procesador tiene 4 cores a 2.1GHz. Tiene una &lt;em&gt;app store&lt;/em&gt; de aplicaciones que permite ampliar las funcionalidades del NAS y en caso de no encontrar alguna se podría usar Docker.&lt;/p&gt;
&lt;p&gt;Contras:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;el precio 550-600€&lt;/li&gt;
&lt;li&gt;el procesador no se puede cambiar, y la RAM sólo se puede ampliar con garantías hasta 8GB&lt;/li&gt;
&lt;li&gt;las aplicaciones para el móvil no tienen muy buenas valoraciones&lt;/li&gt;
&lt;li&gt;lo veo justo tanto de procesador como de memoria RAM para las funcionalidades que quiero que ofrezca&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;ds1618&#34;&gt;DS1618+&lt;/h4&gt;
&lt;p&gt;Cumple con casi todos los requisitos, la única excepción es la ampliación de recursos. Tiene 6 bahías y la posibilidad de comprar una extensión que permitiría añadir más discos. De serie viene con 4GB de RAM ampliables a 32GB. El procesador tiene 4 cores a 2.1GHz. Tiene una &lt;em&gt;app store&lt;/em&gt; de aplicaciones que permite ampliar las funcionalidades del NAS y en caso de no encontrar alguna se podría usar Docker.&lt;/p&gt;
&lt;p&gt;Contras:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;el precio 750€&lt;/li&gt;
&lt;li&gt;el procesador no se puede cambiar&lt;/li&gt;
&lt;li&gt;las aplicaciones para el móvil no tienen muy buenas valoraciones&lt;/li&gt;
&lt;li&gt;lo veo justo de procesador para las funcionalidades que quiero que ofrezca&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;nas-diy&#34;&gt;NAS DIY&lt;/h3&gt;
&lt;p&gt;He estado investigado diferentes alternativas de SO orientados a montar un NAS, y he encontrado que el más usado es 
&lt;a href=&#34;https://www.freenas.org/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;FreeNas&lt;/a&gt;. También he encontrado otra alternativa que me gusta más: 
&lt;a href=&#34;https://unraid.net/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;unRaid&lt;/a&gt;.&lt;/p&gt;
&lt;p&gt;Muchas de las funcionalidades que quiero cubrir no son ofrecidas directamente por esos SOs, sino que hay que instalar algunos plugins/aplicaciones/contenedores para cubrirlas.&lt;/p&gt;
&lt;h4 id=&#34;freenas&#34;&gt;FreeNas&lt;/h4&gt;
&lt;p&gt;Está basado en &lt;em&gt;FreeBSD&lt;/em&gt; y soporta el sistema de ficheros &lt;em&gt;ZFS&lt;/em&gt;, que por lo que he leído debe de ser muy bueno y solventa los inconvenientes de RAID.&lt;/p&gt;
&lt;p&gt;Contras:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;al estar basado en FreeBSD no tiene soporte nativo de Docker&lt;/li&gt;
&lt;li&gt;muchas de las funcionalidades se cubren con aplicaciones/plugins que hay que buscar, instalar y configurar, con el esfuerzo que esto conlleva&lt;/li&gt;
&lt;li&gt;la existencia de aplicaciones móviles para cubrir ciertos requisitos depende de las aplicaciones/plugins que se instalen&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&#34;unraid&#34;&gt;unRaid&lt;/h4&gt;
&lt;p&gt;Es un SO basado en Debian, por lo que tiene soporte nativo de Docker. Como se puede deducir de su nombre, no soporta RAID. Lo que hace, es montar un &lt;em&gt;array&lt;/em&gt; con todos los discos, dando la visión de que se trata de un único disco. Como mecanismo de protección tiene un sistema de &lt;em&gt;paridad&lt;/em&gt; que permitiría el fallo de hasta 2 discos del sistema sin perder los datos. Los datos en los discos se almacenan como en un disco normal, de tal forma que si extraemos un disco del array y lo conectamos a otro dispositivo, podremos ver su contenido.&lt;/p&gt;
&lt;p&gt;Contras:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;no es gratuito (pago único de 59-129€, dependiendo del número de discos que se quieran usar)&lt;/li&gt;
&lt;li&gt;muchas de las funcionalidades se cubren con aplicaciones/plugins que hay que buscar, instalar y configurar, con el esfuerzo que esto conlleva&lt;/li&gt;
&lt;li&gt;la existencia de aplicaciones móviles para cubrir ciertos requisitos depende de las aplicaciones/plugins que se instalen&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&#34;comparativa&#34;&gt;Comparativa&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Requisito&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;Synology&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;FreeNas&lt;/th&gt;
&lt;th align=&#34;center&#34;&gt;unRaid&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Tener backups de las Raspberry PI de forma periódica y automática&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tener sincronizados con el NAS algunos directorios tanto de equipos Windows como Linux&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tener las fotos/videos realizadas con dispositivos móviles guardadas directamente en el NAS de forma automática&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tener forma de visualizar a través del móvil las fotografías del NAS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt; &lt;sup id=&#34;fnref:3&#34;&gt;&lt;a href=&#34;#fn:3&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;3&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tener forma de visualizar a través del móvil los documentos del NAS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍  &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍  &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Poder montar un volumen del NAS en cualquiera de los portátiles o PC para hacer un backup manual inicial de documentos o fotos&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Que el NAS haga de forma periódica un backup encriptado a algún cloud&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:1&#34;&gt;&lt;a href=&#34;#fn:1&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Disponer de un cliente de descargas de BitTorrent y poder controlarlo a través del móvil&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Utilizar Plex Media Server como media center&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:4&#34;&gt;&lt;a href=&#34;#fn:4&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;4&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Añadir Radarr, Sonarr y Jackett (o CouchPotato) para el seguimiento de series y películas y descargas automatizadas&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;❓&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Tener un repositorio de código git&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;❓&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Poder editar documentos, hojas de cálculo, presentaciones, diagramas directamente a través del NAS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aplicación de mensajería privada&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aplicación de notas privada&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Aplicación de calendario privada&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:2&#34;&gt;&lt;a href=&#34;#fn:2&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;2&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Poder ampliar libremente los recursos del NAS en un futuro&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👎&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Poder ampliar libremente la funcionalidad del NAS&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:6&#34;&gt;&lt;a href=&#34;#fn:6&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;6&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;td align=&#34;center&#34;&gt;👍 &lt;sup id=&#34;fnref:5&#34;&gt;&lt;a href=&#34;#fn:5&#34; class=&#34;footnote-ref&#34; role=&#34;doc-noteref&#34;&gt;5&lt;/a&gt;&lt;/sup&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h2 id=&#34;conclusión&#34;&gt;Conclusión&lt;/h2&gt;
&lt;p&gt;Me da miedo de que me pase lo mismo que lo que me ha pasado con el QNAP: que me quede corto de recursos con el paso del tiempo y tener poco margen de maniobra. Se trata de dispositios con un coste elevado, como para tener que verse obligado a cambiarlo por el mero hecho de necesitar más RAM (con la inversión de tiempo que hay que realizar para hacer el cambio).&lt;/p&gt;
&lt;p&gt;Decididamente voy a optar por un &lt;strong&gt;NAS DIY&lt;/strong&gt;, y concretamente por uno con &lt;strong&gt;unRaid&lt;/strong&gt;. He visto unos cuantos análisis y videos de su funcionamiento y me ha gustado bastante. Creo que me convence más la idea de array de discos que la de montar un RAID.&lt;/p&gt;
&lt;p&gt;Además que creo que con un mismo equipo puedo cubrir las 2 necesidades: disponer de un PC potente y tener un NAS con más funcionalidades que el actual. En primer lugar compraré el PC que quería comprarme y le instalaré unRaid. Sin me gusta como funciona, le haré una ampliación de hardware. Si por lo que fuera no quedo contento con el resultado, el equipo me vale como PC y volveré a valorar qué hacer para el NAS.&lt;/p&gt;
&lt;p&gt;Cuando haya elegido el hardware, montado el equipo, instalado y configurado unRaid, escribié otro post con la situación final.&lt;/p&gt;
&lt;section class=&#34;footnotes&#34; role=&#34;doc-endnotes&#34;&gt;
&lt;hr&gt;
&lt;ol&gt;
&lt;li id=&#34;fn:1&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Usando Duplicati &lt;a href=&#34;#fnref:1&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:2&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Usando Nexcloud &lt;a href=&#34;#fnref:2&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:3&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Plex Media Server también permite ver fotos, quiero ver si la gestión de álbumes es similar a google fotos o al menos mejor que la de Nexcloud &lt;a href=&#34;#fnref:3&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:4&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Seguro que se puede pero hay que buscar una aplicación que permita hacerlo &lt;a href=&#34;#fnref:4&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:5&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Con algún contenedor Docker &lt;a href=&#34;#fnref:5&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li id=&#34;fn:6&#34; role=&#34;doc-endnote&#34;&gt;
&lt;p&gt;Usando los Jail de FreeBSD (no tan extendido como los contenedores Docker) &lt;a href=&#34;#fnref:6&#34; class=&#34;footnote-backref&#34; role=&#34;doc-backlink&#34;&gt;&amp;#x21a9;&amp;#xfe0e;&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;/section&gt;
</description>
    </item>
    
    <item>
      <title>Cómo configurar un dominio propio de Google Domains en GitHub Pages y con HTTPS activado</title>
      <link>https://diegocastroviadero.com/post/como-configurar-un-dominio-propio-de-google-domains-en-github-pages-y-con-https-activado/</link>
      <pubDate>Tue, 28 Jan 2020 18:34:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/como-configurar-un-dominio-propio-de-google-domains-en-github-pages-y-con-https-activado/</guid>
      <description>&lt;h2 id=&#34;prerequisitos&#34;&gt;Prerequisitos&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;Tener un dominio en 
&lt;a href=&#34;https://domains.google.com/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;Google Domains&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Tener un repositorio en 
&lt;a href=&#34;https://github.com&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;GitHub&lt;/a&gt; (ej: &lt;a href=&#34;https://github.com/dicastro/dicastro.github.io&#34;&gt;https://github.com/dicastro/dicastro.github.io&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;
&lt;blockquote&gt;
&lt;p&gt;Este repositorio no tiene por qué ser público, en mi caso se trata de un repositorio privado.&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;pasos&#34;&gt;Pasos&lt;/h2&gt;
&lt;h4 id=&#34;1---activa-_github-pages_&#34;&gt;1 - Activa &lt;em&gt;GitHub Pages&lt;/em&gt;&lt;/h4&gt;
&lt;p&gt;Para ello en la configuración del repositorio de &lt;em&gt;GitHub&lt;/em&gt;:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Activa &lt;em&gt;GitHub Pages&lt;/em&gt; seleccionando una rama desde la cuál se va a servir el contenido&lt;/li&gt;
&lt;li&gt;Configura un &lt;em&gt;Custom Domain&lt;/em&gt; (ej: diegocastroviadero.com)&lt;/li&gt;
&lt;/ol&gt;
&lt;h4 id=&#34;2---apunta-el-dominio-diegocastroviaderocom-a-_github-pages_&#34;&gt;2 - Apunta el dominio (diegocastroviadero.com) a &lt;em&gt;GitHub Pages&lt;/em&gt;&lt;/h4&gt;
&lt;p&gt;Para ello en &lt;em&gt;Google Domains&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Añade un &lt;em&gt;Custom resource record&lt;/em&gt; de tipo &lt;code&gt;A&lt;/code&gt; apuntando a &lt;em&gt;GitHub Pages&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Nombre&lt;/th&gt;
&lt;th&gt;Tipo&lt;/th&gt;
&lt;th&gt;TTL&lt;/th&gt;
&lt;th&gt;Datos&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;@&lt;/td&gt;
&lt;td&gt;&lt;code&gt;A&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1h&lt;/td&gt;
&lt;td&gt;185.199.108.153&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt;185.199.109.153&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt;185.199.110.153&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt; &lt;/td&gt;
&lt;td&gt;185.199.111.153&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;En este caso &lt;code&gt;@&lt;/code&gt; hace referencia al propio dominio (diegocastroviadero.com)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Si las IPs anteriores se han quedado desfasadas, podrás encontrar los valores actualizados 
&lt;a href=&#34;https://help.github.com/en/github/working-with-github-pages/managing-a-custom-domain-for-your-github-pages-site#configuring-a-records-with-your-dns-provider&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;aquí&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;3---apunta-el-subdominio-www-a-_github-pages_&#34;&gt;3 - Apunta el subdominio &lt;code&gt;www&lt;/code&gt; a &lt;em&gt;GitHub Pages&lt;/em&gt;&lt;/h4&gt;
&lt;p&gt;Para ello en &lt;em&gt;Google Domains&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Añade un &lt;em&gt;Custom resource record&lt;/em&gt; de tipo &lt;code&gt;CNAME&lt;/code&gt; apuntando a la url de &lt;em&gt;GitHub Pages&lt;/em&gt; correspondiente al repositorio en cuestión (ej: dicastro.github.io)&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Nombre&lt;/th&gt;
&lt;th&gt;Tipo&lt;/th&gt;
&lt;th&gt;TTL&lt;/th&gt;
&lt;th&gt;Datos&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;@&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CNAME&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1h&lt;/td&gt;
&lt;td&gt;dicastro.github.io&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4 id=&#34;4---configura-https&#34;&gt;4 - Configura HTTPS&lt;/h4&gt;
&lt;p&gt;Para ello en la configuración del repositorio de &lt;em&gt;GitHub&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Fuerza el uso de HTTPS&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Y en &lt;em&gt;Google Domains&lt;/em&gt;:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Añade un &lt;em&gt;Custom resource record&lt;/em&gt; de tipo &lt;code&gt;CAA&lt;/code&gt; permitiendo la emisión de certificados para el dominio (ej: diegocastroviadero.com) a la entidad emisora de certificados, que en el caso de &lt;em&gt;GitHub&lt;/em&gt; es &lt;em&gt;letsencrypt&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Nombre&lt;/th&gt;
&lt;th&gt;Tipo&lt;/th&gt;
&lt;th&gt;TTL&lt;/th&gt;
&lt;th&gt;Datos&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;@&lt;/td&gt;
&lt;td&gt;&lt;code&gt;CAA&lt;/code&gt;&lt;/td&gt;
&lt;td&gt;1h&lt;/td&gt;
&lt;td&gt;0 issue &amp;ldquo;letsencrypt.org&amp;rdquo;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;blockquote&gt;
&lt;p&gt;En este caso &lt;code&gt;@&lt;/code&gt; hace referencia al propio dominio (diegocastroviadero.com)&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Para obtener el valor de la columna &lt;em&gt;Datos&lt;/em&gt; de la entrada de tipo &lt;code&gt;CAA&lt;/code&gt; se puede hacer uso de 
&lt;a href=&#34;https://sslmate.com/caa/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;esta utilidad&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&#34;referencias&#34;&gt;Referencias&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://www.techrepublic.com/article/how-to-add-a-certificate-authority-authorization-record-in-google-domains&#34;&gt;https://www.techrepublic.com/article/how-to-add-a-certificate-authority-authorization-record-in-google-domains&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://dev.to/trentyang/how-to-setup-google-domain-for-github-pages-1p58&#34;&gt;https://dev.to/trentyang/how-to-setup-google-domain-for-github-pages-1p58&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Hola Mundo!</title>
      <link>https://diegocastroviadero.com/post/hola-mundo/</link>
      <pubDate>Sat, 14 Dec 2019 15:39:00 +0000</pubDate>
      <guid>https://diegocastroviadero.com/post/hola-mundo/</guid>
      <description>&lt;p&gt;Este es mi primer post de prueba.&lt;/p&gt;
&lt;p&gt;La idea es utilizar este blog para escribir artículos relacionados con algunos de mis intereses a modo de base de datos para posteriores consultas. Serán artículos sobre algún tema nuevo que esté investigando o artículos sobre cómo resolver problemas a los que me haya enfrentado.&lt;/p&gt;
</description>
    </item>
    
  </channel>
</rss>
